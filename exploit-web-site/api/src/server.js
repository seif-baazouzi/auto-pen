if(!process.env.JWT_SECRET) throw new Error("The env variable SECRET is not set")

const express = require("express")
const app = express()

const cors = require("cors")
const db   = require("./utils/db")

app.use(cors())
app.use(require("body-parser").json())

// auth routes
app.use("/api/v1/auth", require("./routes/auth"))
app.use("/api/v1/auth/login", require("./routes/auth/login"))
app.use("/api/v1/auth/signup", require("./routes/auth/signup"))

// scan routes
app.use("/api/v1/scans", require("./routes/scans/get-scan"))
app.use("/api/v1/scans", require("./routes/scans/add-scan"))
app.use("/api/v1/scans", require("./routes/scans/del-scan"))
app.use("/api/v1/scans", require("./routes/scans/get-scans"))

db.on("open", () => {
  console.log("Connected to mongodb")
  app.listen(4000, () => console.log("API server running on port 4000"))
})

db.on("error", () => {
  throw new Error("Failed to connect to mongodb")
})
