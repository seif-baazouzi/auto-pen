const express = require("express")
const scan = express.Router()

const Scan = require("../../models/scan")
const tokens = require("../../utils/tokens")
const trycatch = require("../../utils/try-catch")

scan.get("/", tokens.auth(), async (req, res) => {
  trycatch(req, res, async () => {
    const scans = (await Scan.find(
      { user: req.body.id, done: !("running" in req.query) },
      { _id: 1, url: 1, done: 1 }
    )).map(s => ({ id: s._id, url: s.url, done: s.done }))
    
    res.json({ scans })
  })
})

module.exports = scan
