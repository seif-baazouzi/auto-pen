import { useRouter } from "next/router"
import { useState } from "react"
import ajax from "../utils/ajax"
import { parseCookies } from "../utils/cookies"
import Input from "./Input"
import PopUp from "./PopUp"

export default function AddScan({ showState }) {
  const router = useRouter()
  const [url, setUrl] = useState("http://172.17.0.1:8080/")
  const [error, setError] = useState("")
  const [cookies, setCookies] = useState("")
  
  const submit = async (event) => {
    event.preventDefault()

    const { token } = parseCookies(document.cookie)
    const res = await ajax.post(`/api/v1/scans`, { token }, { url, cookies })
     
    if(res.message === "success") {
      const [_, setShow] = showState
      router.replace(router.asPath)
      setShow(false)
    } else {
      setError(res.url)
    }
  }
  
  return (
    <PopUp showState={showState}>
      <h1>Add a new scan</h1>
      <form onSubmit={submit}>
        <Input
          label="Url"
          type="text"
          error={error}
          state={[url, setUrl]}
        />
        <Input
          label="Cookies"
          type="text"
          error={null}
          state={[cookies, setCookies]}
        />
        <button>Start scan</button>
      </form>
    </PopUp>
  )
}
