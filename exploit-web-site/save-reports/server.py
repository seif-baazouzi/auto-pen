import json
from flask import Flask, request

from db import db
from bson.objectid import ObjectId

app = Flask(__name__)

@app.patch("/<scanID>")
def add(scanID):
  try:
    report = request.json["report"]
    db.scans.update_one(
      { "_id"  : ObjectId(scanID) },
      { "$set" : { "report": report, "done": True } }
    )

    return json.dumps({ "message": "success" })
  except:
    return json.dumps({ "message": "try-again" })

if __name__ == "__main__":
  app.run(debug=True, port=4444, host="0.0.0.0")
