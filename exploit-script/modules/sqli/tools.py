import os

###########################################################################
###########################################################################

sqlmapCommand = "sqlmap --flush-session --disable-coloring --threads=10 --batch --output-dir=$PWD/tmp"

###########################################################################
###########################################################################

def getSqlmapOuput():
  return os.popen("/bin/cat tmp/*/log").read().strip()

###########################################################################
###########################################################################

class SQLiResult:
  def __init__(self, url, kind):
    self.url = url
    self.kind = kind
    self.results = getSqlmapOuput()

  def cmd(self):
    return f"{sqlmapCommand} -u '{self.url}'{'' if self.kind == 'url' else ' --forms'}"

###########################################################################
###########################################################################

def getCookies(cookies):
  return f" --cookie '{cookies}'" if cookies else ""

###########################################################################
###########################################################################

def testUrl(url, cookies):
  cmd = f"{sqlmapCommand} -u '{url}'{getCookies(cookies)}"
  out = os.popen(cmd).read()

  if "is vulnerable" in out:
    return SQLiResult(url, "url")
  
  return None

###########################################################################
###########################################################################

def testForms(url, cookies):
  cmd = f"{sqlmapCommand} -u '{url}' --forms{getCookies(cookies)}"
  out = os.popen(cmd).read()
  
  if "is vulnerable" in out:
    return SQLiResult(url, "forms")
  
  return None
