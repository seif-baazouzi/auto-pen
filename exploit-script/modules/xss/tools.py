import time
from selenium import webdriver
from selenium.webdriver.firefox.options import Options

from utils.parselist import parseList

###########################################################################
###########################################################################

options = Options()
options.headless = True

isDriverRuning = False
driver = webdriver.Firefox(options=options)

def getJSResult(html, javascript):
  global isDriverRuning

  while isDriverRuning:
    time.sleep(0.01)

  isDriverRuning = True
  
  driver.get(f"data:text/html;charset=utf-8,{html}")
  result = driver.execute_script("""
    function simulateMouseEnter() {
      const event = new MouseEvent('mouseenter', {
        'view': window,
        'bubbles': true,
        'cancelable': true
      }); 
      if(window.XsSid)
      XsSid.dispatchEvent(event);
    }
    simulateMouseEnter()
    %s
  """ % javascript)

  isDriverRuning = False
  
  return result 

def closeDriver():
  driver.close()

###########################################################################
###########################################################################

payload = "window.randomTestXssProp=1234"
payloads = parseList("xss.txt", payload)
